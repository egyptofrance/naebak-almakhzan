# Naebak Database ERD - مخطط علاقات قواعد البيانات

## 📊 **نظرة عامة على قواعد البيانات**

### **قواعد البيانات الرئيسية:**
- **naebak_auth** - PostgreSQL (المصادقة والمستخدمين)
- **naebak_admin** - PostgreSQL (الإدارة والإعدادات)
- **naebak_complaints** - PostgreSQL (الشكاوى والمرفقات)
- **naebak_messages** - PostgreSQL (الرسائل والمحادثات)
- **naebak_ratings** - PostgreSQL (التقييمات والتعليقات)
- **naebak_content** - SQLite (المحتوى والصفحات)
- **naebak_news** - SQLite (الأخبار والشريط الإخباري)
- **naebak_banners** - SQLite (البنرات والإعلانات)
- **naebak_statistics** - Redis (الإحصائيات والعدادات)

---

## 🗄️ **مخطط علاقات قواعد البيانات**

### **1. قاعدة بيانات المصادقة (naebak_auth)**

```
┌─────────────────────────────────────────────────────────────────┐
│                        NAEBAK_AUTH DATABASE                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   Governorates  │    │     Parties     │    │  Councils    │ │
│  │─────────────────│    │─────────────────│    │──────────────│ │
│  │ id (PK)         │    │ id (PK)         │    │ id (PK)      │ │
│  │ name_ar         │    │ name_ar         │    │ name_ar      │ │
│  │ name_en         │    │ name_en         │    │ name_en      │ │
│  │ code            │    │ logo_url        │    │ type         │ │
│  │ region          │    │ color           │    │ description  │ │
│  │ created_at      │    │ is_active       │    │ is_active    │ │
│  └─────────────────┘    │ created_at      │    │ created_at   │ │
│           │              └─────────────────┘    └──────────────┘ │
│           │                       │                      │       │
│           │                       │                      │       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                        Users                                │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ username                                                    │ │
│  │ email                                                       │ │
│  │ phone                                                       │ │
│  │ whatsapp                                                    │ │
│  │ full_name                                                   │ │
│  │ address                                                     │ │
│  │ governorate_id (FK) ──────────────────────────────────────┐ │ │
│  │ user_type (citizen/candidate/member)                      │ │ │
│  │ is_active                                                 │ │ │
│  │ created_at                                                │ │ │
│  │ updated_at                                                │ │ │
│  └───────────────────────────────────────────────────────────┘ │ │
│                                    │                             │ │
│                                    └─────────────────────────────┘ │
│                                                                    │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    Candidates                               │   │
│  │─────────────────────────────────────────────────────────────│   │
│  │ id (PK)                                                     │   │
│  │ user_id (FK) ──────────────────────────────────────────────┐│   │
│  │ party_id (FK) ──────────────────────────────────────────┐  ││   │
│  │ council_id (FK) ────────────────────────────────────┐   │  ││   │
│  │ constituency                                       │   │  ││   │
│  │ electoral_number                                   │   │  ││   │
│  │ electoral_symbol                                   │   │  ││   │
│  │ candidate_type (candidate/current_member)          │   │  ││   │
│  │ membership_start_date                              │   │  ││   │
│  │ committees                                         │   │  ││   │
│  │ biography                                          │   │  ││   │
│  │ achievements                                       │   │  ││   │
│  │ promises                                           │   │  ││   │
│  │ is_verified                                        │   │  ││   │
│  │ created_at                                         │   │  ││   │
│  │ updated_at                                         │   │  ││   │
│  └────────────────────────────────────────────────────┘   │  ││   │
│                                                           │  ││   │
│                                                           │  │└───┘
│                                                           │  └─────┘
│                                                           └────────┘
└─────────────────────────────────────────────────────────────────┘
```

### **2. قاعدة بيانات الشكاوى (naebak_complaints)**

```
┌─────────────────────────────────────────────────────────────────┐
│                    NAEBAK_COMPLAINTS DATABASE                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  ComplaintTypes                             │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ name_ar                                                     │ │
│  │ name_en                                                     │ │
│  │ council_type (parliament/senate)                            │ │
│  │ color                                                       │ │
│  │ icon                                                        │ │
│  │ description                                                 │ │
│  │ is_active                                                   │ │
│  │ created_at                                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                    │                             │
│                                    │                             │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Complaints                               │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ citizen_id (FK) ────────────────────────────────────────────┤ │
│  │ candidate_id (FK) ──────────────────────────────────────────┤ │
│  │ complaint_type_id (FK) ─────────────────────────────────────┘ │
│  │ title                                                         │
│  │ description                                                   │
│  │ location                                                      │
│  │ youtube_link                                                  │
│  │ status (pending/in_progress/resolved/rejected)                │
│  │ priority (low/medium/high/urgent)                             │
│  │ admin_response                                                │
│  │ resolved_at                                                   │
│  │ created_at                                                    │
│  │ updated_at                                                    │
│  └─────────────────────────────────────────────────────────────┘ │
│                                    │                             │
│                                    │                             │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                ComplaintAttachments                         │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ complaint_id (FK) ──────────────────────────────────────────┘ │
│  │ file_name                                                     │
│  │ file_path                                                     │
│  │ file_type                                                     │
│  │ file_size                                                     │
│  │ mime_type                                                     │
│  │ is_verified                                                   │
│  │ uploaded_at                                                   │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### **3. قاعدة بيانات الرسائل (naebak_messages)**

```
┌─────────────────────────────────────────────────────────────────┐
│                     NAEBAK_MESSAGES DATABASE                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                     Messages                                │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ sender_id (FK) ─────────────────────────────────────────────┤ │
│  │ recipient_id (FK) ──────────────────────────────────────────┤ │
│  │ subject                                                     │ │
│  │ content                                                     │ │
│  │ message_type (direct/broadcast/announcement)                │ │
│  │ priority (normal/high/urgent)                               │ │
│  │ is_read                                                     │ │
│  │ read_at                                                     │ │
│  │ is_archived                                                 │ │
│  │ parent_message_id (FK) ─────────────────────────────────────┤ │
│  │ created_at                                                  │ │
│  │ updated_at                                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                    │                             │
│                                    │                             │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                MessageAttachments                           │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ message_id (FK) ────────────────────────────────────────────┘ │
│  │ file_name                                                     │
│  │ file_path                                                     │
│  │ file_type                                                     │
│  │ file_size                                                     │
│  │ uploaded_at                                                   │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### **4. قاعدة بيانات التقييمات (naebak_ratings)**

```
┌─────────────────────────────────────────────────────────────────┐
│                     NAEBAK_RATINGS DATABASE                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                      Ratings                                │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ citizen_id (FK) ────────────────────────────────────────────┤ │
│  │ candidate_id (FK) ──────────────────────────────────────────┤ │
│  │ rating (1-5)                                                │ │
│  │ comment                                                     │ │
│  │ category (performance/communication/promises/overall)       │ │
│  │ is_anonymous                                                │ │
│  │ is_verified                                                 │ │
│  │ created_at                                                  │ │
│  │ updated_at                                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                 RatingsSummary                              │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ candidate_id (FK) ──────────────────────────────────────────┤ │
│  │ total_ratings                                               │ │
│  │ average_rating                                              │ │
│  │ performance_avg                                             │ │
│  │ communication_avg                                           │ │
│  │ promises_avg                                                │ │
│  │ overall_avg                                                 │ │
│  │ last_updated                                                │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### **5. قاعدة بيانات الإدارة (naebak_admin)**

```
┌─────────────────────────────────────────────────────────────────┐
│                      NAEBAK_ADMIN DATABASE                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    AdminUsers                               │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ username                                                    │ │
│  │ email                                                       │ │
│  │ full_name                                                   │ │
│  │ role (super_admin/admin/moderator)                          │ │
│  │ permissions                                                 │ │
│  │ is_active                                                   │ │
│  │ last_login                                                  │ │
│  │ created_at                                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  SystemSettings                             │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ key                                                         │ │
│  │ value                                                       │ │
│  │ description                                                 │ │
│  │ category                                                    │ │
│  │ is_public                                                   │ │
│  │ updated_by (FK)                                             │ │
│  │ updated_at                                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  SocialMediaLinks                           │ │
│  │─────────────────────────────────────────────────────────────│ │
│  │ id (PK)                                                     │ │
│  │ platform (facebook/twitter/instagram/youtube/linkedin)     │ │
│  │ url                                                         │ │
│  │ icon                                                        │ │
│  │ is_active                                                   │ │
│  │ order_index                                                 │ │
│  │ updated_at                                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔗 **العلاقات بين قواعد البيانات**

### **العلاقات الرئيسية:**

```
Users (naebak_auth) ←──→ Candidates (naebak_auth)
    │                         │
    ├─→ Messages (naebak_messages)
    ├─→ Complaints (naebak_complaints)  
    ├─→ Ratings (naebak_ratings)
    └─→ Statistics (Redis)

Governorates (naebak_auth) ←──→ Users
Parties (naebak_auth) ←──→ Candidates
Councils (naebak_auth) ←──→ Candidates
ComplaintTypes (naebak_complaints) ←──→ Complaints
```

### **مفاتيح الربط:**
- **user_id**: ربط المستخدمين عبر الخدمات
- **candidate_id**: ربط المرشحين والنواب
- **governorate_id**: ربط المحافظات
- **party_id**: ربط الأحزاب
- **council_id**: ربط المجالس

---

## 📊 **إحصائيات قواعد البيانات**

### **الجداول الرئيسية:**
- **Users**: 100,000+ سجل متوقع
- **Candidates**: 5,000+ مرشح ونائب
- **Messages**: 1,000,000+ رسالة
- **Complaints**: 500,000+ شكوى
- **Ratings**: 2,000,000+ تقييم

### **الفهارس المطلوبة:**
```sql
-- فهارس الأداء
CREATE INDEX idx_users_governorate ON users(governorate_id);
CREATE INDEX idx_candidates_party ON candidates(party_id);
CREATE INDEX idx_complaints_status ON complaints(status);
CREATE INDEX idx_messages_recipient ON messages(recipient_id);
CREATE INDEX idx_ratings_candidate ON ratings(candidate_id);
```

### **النسخ الاحتياطية:**
- **يومية**: للبيانات الحساسة (Users, Messages)
- **أسبوعية**: للبيانات المتوسطة (Complaints, Ratings)
- **شهرية**: للبيانات الثابتة (Settings, Types)

---

## 🛡️ **الأمان وحماية البيانات**

### **تشفير البيانات:**
- **كلمات المرور**: bcrypt hashing
- **البيانات الحساسة**: AES-256 encryption
- **الاتصالات**: SSL/TLS

### **صلاحيات الوصول:**
- **المواطنون**: قراءة بياناتهم فقط
- **المرشحون**: قراءة بياناتهم + رسائلهم
- **الإدارة**: وصول كامل مع تسجيل العمليات

### **مراقبة الأداء:**
- **استعلامات بطيئة**: > 1 ثانية
- **استهلاك الذاكرة**: مراقبة مستمرة
- **اتصالات قاعدة البيانات**: حد أقصى 100 اتصال

هذا المخطط يوضح العلاقات الكاملة بين جميع قواعد البيانات ويساعد في فهم تدفق البيانات وتصميم APIs بشكل صحيح.
